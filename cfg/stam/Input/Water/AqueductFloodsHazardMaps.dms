////////////////////////////////////////////////////////////////////////////////////////////
//            (C) Configuration Towards an Urban Preview - 2UP 2021                       //
//         Netherlands Environmental Assessment Agency http://www.pbl.nl/en/contact       //
//  This work is licensed under a Creative Commons Attribution 4.0 International License  //
//              CC BY-SA 4.0 https://creativecommons.org/licenses/by-sa/4.0/              //
////////////////////////////////////////////////////////////////////////////////////////////

// Author:   Bas van Bemmel
// Function: for modelruns with restrictions (VU Amsterdam)

//https://en.wikipedia.org/wiki/Representative_Concentration_Pathway
container AqueductFloodsHazardMaps
{
	container coastal
	{
		//Optimistic Climate Change Scenario: RCP 4.5
		container rcp4p5
		{
			unit<ipoint> inuncoast_rcp4p5_wtsub_2080_rp1000_0_perc_50:StorageName = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/coastal_aqueduct/inuncoast_rcp4p5_wtsub_2080_rp1000_0_perc_50.tif",
			StorageType     = "gdal.grid",
			url             = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/AqueductFloodsHazardMapsVersion2.mhtml",
			Source          = "https://www.wri.org/resources/data-sets/aqueduct-floods-hazard-maps",
			StorageReadOnly = "True",
			DialogData      = "LatLong"
			{
				attribute<float32> ReadData(gtopo);
				attribute<float32> ReadData0(gtopo):=ReadData = -9999f ? 0f : ReadData;
				
				attribute<bool>    ReadData0_bool(gtopo):=ReadData0 > 0f;
			}
		}
		
		container rcp8p5
		{
			//Pessimistic/ Business as Usual Scenario: RCP 8.5
			unit<ipoint> inuncoast_rcp8p5_wtsub_2080_rp1000_0_perc_50:StorageName = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/coastal_aqueduct/inuncoast_rcp8p5_wtsub_2080_rp1000_0_perc_50.tif",
			StorageType     = "gdal.grid",
			StorageReadOnly = "True",
			DialogData      = "LatLong"
			{
				attribute<float32> ReadData(gtopo);
				attribute<float32> ReadData0(gtopo):=ReadData = -9999f ? 0f : ReadData;
				
				attribute<bool>    ReadData0_bool(gtopo):=ReadData0 > 0f;
			}
		}
	}


	container river
	{
		container rcp6p0
		{
			unit<ipoint> inunriver_rcp6p0_00000NorESM1_M_2080_rp01000:StorageName = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/riverine_aqueduct/inunriver_rcp6p0_00000NorESM1_M_2080_rp01000.tif",
			//StorageType     = "gdal.grid",
			url             = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/AqueductFloodsHazardMapsVersion2.mhtml",
			Source          = "http://wri-projects.s3.amazonaws.com/AqueductFloodTool/download/v2/index.html",
			StorageReadOnly = "True",
			DialogData      = "LatLong"
			{
				attribute<float32> ReadData(gtopo);
				attribute<float32> ReadData0(gtopo):=ReadData = 1E+20f ? 0f : ReadData;
				attribute<bool>    ReadData0_bool(gtopo):=ReadData0 > 0f;
			}
			
			unit<ipoint> inunriver_rcp6p0_00000NorESM1_M_2080_rp01000_new:StorageName = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/riverine_aqueduct/inunriver_rcp6p0_00000NorESM1_M_2080_rp01000_new.tif",
			//StorageType     = "gdal.grid",
			url             = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/AqueductFloodsHazardMapsVersion2.mhtml",
			Source          = "http://wri-projects.s3.amazonaws.com/AqueductFloodTool/download/v2/index.html",
			StorageReadOnly = "True",
			DialogData      = "LatLong"
			{
				attribute<float32> ReadData(gtopo);
				attribute<float32> ReadData0(gtopo):=ReadData = 1E+20f ? 0f : ReadData;
				attribute<bool>    ReadData0_bool(gtopo):=ReadData0 > 0f;
			}
		}
		
		
		
		
		container rcp4p5
		{
			unit<ipoint> inunriver_rcp4p5_00000NorESM1_M_2080_rp01000:StorageName = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/riverine_aqueduct/inunriver_rcp4p5_00000NorESM1_M_2080_rp01000.tif",
			StorageType     = "gdal.grid",
			url             = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/AqueductFloodsHazardMapsVersion2.mhtml",
			Source          = "http://wri-projects.s3.amazonaws.com/AqueductFloodTool/download/v2/index.html",
			StorageReadOnly = "True",
			DialogData      = "LatLong"
			{
				attribute<float32> ReadData(gtopo);
				attribute<float32> ReadData0(gtopo):=ReadData = -9999f ? 0f : ReadData;
				attribute<bool>    ReadData0_bool(gtopo):=ReadData0 > 0f;
			}
			
			unit<ipoint> inunriver_rcp4p5_0000GFDL_ESM2M_2080_rp01000:StorageName = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/riverine_aqueduct/inunriver_rcp4p5_0000GFDL_ESM2M_2080_rp01000.tif",
			StorageType     = "gdal.grid",
			url             = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/AqueductFloodsHazardMapsVersion2.mhtml",
			Source          = "http://wri-projects.s3.amazonaws.com/AqueductFloodTool/download/v2/index.html",
			StorageReadOnly = "True",
			DialogData      = "LatLong"
			{
				attribute<float32> ReadData(gtopo);
				attribute<float32> ReadData0(gtopo):=ReadData = -9999f ? 0f : ReadData;
				attribute<bool>    ReadData0_bool(gtopo):=ReadData0 > 0f;
			}
			
			unit<ipoint> inunriver_rcp4p5_0000HadGEM2_ES_2080_rp01000:StorageName = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/riverine_aqueduct/inunriver_rcp4p5_0000HadGEM2_ES_2080_rp01000.tif",
			StorageType     = "gdal.grid",
			url             = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/AqueductFloodsHazardMapsVersion2.mhtml",
			Source          = "http://wri-projects.s3.amazonaws.com/AqueductFloodTool/download/v2/index.html",
			StorageReadOnly = "True",
			DialogData      = "LatLong"
			{
				attribute<float32> ReadData(gtopo);
				attribute<float32> ReadData0(gtopo):=ReadData = -9999f ? 0f : ReadData;
				attribute<bool>    ReadData0_bool(gtopo):=ReadData0 > 0f;
			}
			
			unit<ipoint> inunriver_rcp4p5_00IPSL_CM5A_LR_2080_rp01000:StorageName = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/riverine_aqueduct/inunriver_rcp4p5_00IPSL_CM5A_LR_2080_rp01000.tif",
			StorageType     = "gdal.grid",
			url             = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/AqueductFloodsHazardMapsVersion2.mhtml",
			Source          = "http://wri-projects.s3.amazonaws.com/AqueductFloodTool/download/v2/index.html",
			StorageReadOnly = "True",
			DialogData      = "LatLong"
			{
				attribute<float32> ReadData(gtopo);
				attribute<float32> ReadData0(gtopo):=ReadData = -9999f ? 0f : ReadData;
				attribute<bool>    ReadData0_bool(gtopo):=ReadData0 > 0f;
			}
			
			unit<ipoint> inunriver_rcp4p5_MIROC_ESM_CHEM_2080_rp01000:StorageName = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/riverine_aqueduct/inunriver_rcp4p5_MIROC_ESM_CHEM_2080_rp01000.tif",
			StorageType     = "gdal.grid",
			url             = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/AqueductFloodsHazardMapsVersion2.mhtml",
			Source          = "http://wri-projects.s3.amazonaws.com/AqueductFloodTool/download/v2/index.html",
			StorageReadOnly = "True",
			DialogData      = "LatLong"
			{
				attribute<float32> ReadData(gtopo);
				attribute<float32> ReadData0(gtopo):=ReadData = -9999f ? 0f : ReadData;
				attribute<bool>    ReadData0_bool(gtopo):=ReadData0 > 0f;
			}
			
			attribute<float32> inunriver_rcp4p5_2080_rp01000 (gtopo)   := max_elem(
																		inunriver_rcp4p5_00000NorESM1_M_2080_rp01000/ReadData0,
																		inunriver_rcp4p5_0000GFDL_ESM2M_2080_rp01000/ReadData0,
																		inunriver_rcp4p5_0000HadGEM2_ES_2080_rp01000/ReadData0,
																		inunriver_rcp4p5_00IPSL_CM5A_LR_2080_rp01000/ReadData0,
																		inunriver_rcp4p5_MIROC_ESM_CHEM_2080_rp01000/ReadData0
																		)
																		, DialogType ="BrushColor";
			attribute<bool> inunriver_rcp4p5_2080_rp01000_bool (gtopo)   := inunriver_rcp4p5_2080_rp01000 > 0f;
		}

		container rcp8p5
		{
			unit<ipoint> inunriver_rcp8p5_00000NorESM1_M_2080_rp01000:StorageName = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/riverine_aqueduct/inunriver_rcp8p5_00000NorESM1_M_2080_rp01000.tif",
			StorageType     = "gdal.grid",
			url             = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/AqueductFloodsHazardMapsVersion2.mhtml",
			Source          = "http://wri-projects.s3.amazonaws.com/AqueductFloodTool/download/v2/index.html",
			StorageReadOnly = "True",
			DialogData      = "LatLong"
			{
				attribute<float32> ReadData(gtopo);
				attribute<float32> ReadData0(gtopo):=ReadData = -9999f ? 0f : ReadData;
				attribute<bool>    ReadData0_bool(gtopo):=ReadData0 > 0f;
			}
			
			unit<ipoint> inunriver_rcp8p5_0000GFDL_ESM2M_2080_rp01000:StorageName = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/riverine_aqueduct/inunriver_rcp8p5_0000GFDL_ESM2M_2080_rp01000.tif",
			StorageType     = "gdal.grid",
			url             = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/AqueductFloodsHazardMapsVersion2.mhtml",
			Source          = "http://wri-projects.s3.amazonaws.com/AqueductFloodTool/download/v2/index.html",
			StorageReadOnly = "True",
			DialogData      = "LatLong"
			{
				attribute<float32> ReadData(gtopo);
				attribute<float32> ReadData0(gtopo):=ReadData = -9999f ? 0f : ReadData;
				attribute<bool>    ReadData0_bool(gtopo):=ReadData0 > 0f;
			}
			
			unit<ipoint> inunriver_rcp8p5_0000HadGEM2_ES_2080_rp01000:StorageName = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/riverine_aqueduct/inunriver_rcp8p5_0000HadGEM2_ES_2080_rp01000.tif",
			StorageType     = "gdal.grid",
			url             = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/AqueductFloodsHazardMapsVersion2.mhtml",
			Source          = "http://wri-projects.s3.amazonaws.com/AqueductFloodTool/download/v2/index.html",
			StorageReadOnly = "True",
			DialogData      = "LatLong"
			{
				attribute<float32> ReadData(gtopo);
				attribute<float32> ReadData0(gtopo):=ReadData = -9999f ? 0f : ReadData;
				attribute<bool>    ReadData0_bool(gtopo):=ReadData0 > 0f;
			}
			
			unit<ipoint> inunriver_rcp8p5_00IPSL_CM5A_LR_2080_rp01000:StorageName = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/riverine_aqueduct/inunriver_rcp8p5_00IPSL_CM5A_LR_2080_rp01000.tif",
			StorageType     = "gdal.grid",
			url             = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/AqueductFloodsHazardMapsVersion2.mhtml",
			Source          = "http://wri-projects.s3.amazonaws.com/AqueductFloodTool/download/v2/index.html",
			StorageReadOnly = "True",
			DialogData      = "LatLong"
			{
				attribute<float32> ReadData(gtopo);
				attribute<float32> ReadData0(gtopo):=ReadData = -9999f ? 0f : ReadData;
				attribute<bool>    ReadData0_bool(gtopo):=ReadData0 > 0f;
			}
			
			unit<ipoint> inunriver_rcp8p5_MIROC_ESM_CHEM_2080_rp01000:StorageName = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/riverine_aqueduct/inunriver_rcp8p5_MIROC_ESM_CHEM_2080_rp01000.tif",
			StorageType     = "gdal.grid",
			url             = "%MondiaalDataDir%/Water/AqueductFloodsHazardMaps/AqueductFloodsHazardMapsVersion2.mhtml",
			Source          = "http://wri-projects.s3.amazonaws.com/AqueductFloodTool/download/v2/index.html",
			StorageReadOnly = "True",
			DialogData      = "LatLong"
			{
				attribute<float32> ReadData(gtopo);
				attribute<float32> ReadData0(gtopo):=ReadData = -9999f ? 0f : ReadData;
				attribute<bool>    ReadData0_bool(gtopo):=ReadData0 > 0f;
			}
			
			attribute<float32> inunriver_rcp8p5_2080_rp01000 (gtopo)   := max_elem(
																		inunriver_rcp8p5_00000NorESM1_M_2080_rp01000/ReadData0,
																		inunriver_rcp8p5_0000GFDL_ESM2M_2080_rp01000/ReadData0,
																		inunriver_rcp8p5_0000HadGEM2_ES_2080_rp01000/ReadData0,
																		inunriver_rcp8p5_00IPSL_CM5A_LR_2080_rp01000/ReadData0,
																		inunriver_rcp8p5_MIROC_ESM_CHEM_2080_rp01000/ReadData0
																		)
																		, DialogType ="BrushColor";
			attribute<bool> inunriver_rcp8p5_2080_rp01000_bool (gtopo)   := inunriver_rcp8p5_2080_rp01000 > 0f;
		}
	}

	//in meters
	attribute<float32> inun_rcp4p5_2080_rp1000 (gtopo)      := max_elem(coastal/rcp4p5/inuncoast_rcp4p5_wtsub_2080_rp1000_0_perc_50/ReadData0, river/rcp4p5/inunriver_rcp4p5_2080_rp01000), DialogType ="BrushColor";
	attribute<bool>    inun_rcp4p5_2080_rp1000_bool (gtopo) := inun_rcp4p5_2080_rp1000 > 0f;
	
	attribute<float32> inun_rcp8p5_2080_rp1000 (gtopo)      := max_elem(coastal/rcp8p5/inuncoast_rcp8p5_wtsub_2080_rp1000_0_perc_50/ReadData0, river/rcp8p5/inunriver_rcp8p5_2080_rp01000), DialogType ="BrushColor";
	attribute<bool>    inun_rcp8p5_2080_rp1000_bool (gtopo) := inun_rcp8p5_2080_rp1000 > 0f;


	unit<uint8> OverlayRegios: nrofrows = 2
	{
		attribute<string> names: ['rcp4p5', 'rcp8p5'];
	}

	container OverlayGrids
	{
		attribute<uint2>  rcp4p5 (gtopo) := inun_rcp4p5_2080_rp1000_bool[uint2];
		attribute<uint2>  rcp8p5 (gtopo) := inun_rcp8p5_2080_rp1000_bool[uint2];
		
		attribute<string> Key     (gtopo) := string(rcp4p5) + "_" + string(rcp8p5);
		attribute<bool>   OnlyInrcp4p5 (gtopo) := strcount(key, '1_0') > 0;
		attribute<bool>   OnlyInrcp8p5 (gtopo) := strcount(key, '0_1') > 0;
		attribute<bool>   Bothrcp (gtopo)      := strcount(key, '1_1') > 0;
	}

	unit<uint32> rcpcombine:= overlay32(OverlayRegios/names, gtopo, OverlayGrids)
	{
		attribute<uint32> ID            := ID(.);
		attribute<string> rcp4p5_rcp8p5 := string(rcp4p5) + "_" + string(rcp8p5);
	}
}

